<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>AI Photo Book</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f9fafb;
      padding: 40px;
    }

    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }

    input, textarea, button {
      width: 100%;
      margin-top: 12px;
      padding: 10px;
      font-size: 15px;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    button {
      background: #6366f1;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    button:hover {
      background: #4f46e5;
    }

    .progress-bar {
      width: 100%;
      background: #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 18px;
    }

    .progress {
      height: 22px;
      background: #6366f1;
      width: 0%;
      color: white;
      font-size: 13px;
      text-align: center;
      line-height: 22px;
      transition: width .4s;
    }

    .status {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      color: #374151;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid #e5e7eb;
      border-top: 3px solid #6366f1;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .spinner.stop {
      animation: none;
    }

    .status.error {
      color: #dc2626;
    }

    .status.success {
      color: #16a34a;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .page {
      margin-top: 25px;
    }

    img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<div class="container">
  <h2>üìò AI Photo Book (Stable Horde)</h2>

  <!-- ‚úÖ CH·ªà 1 PH·∫¶N NH·∫¨P -->
  <input type="file" id="images" multiple>
  <textarea id="prompt" placeholder="V√≠ d·ª•: cinematic illustration, soft light, high detail"></textarea>
  <button onclick="createBook()">‚ú® T·∫°o ·∫£nh</button>

  <div class="progress-bar">
    <div id="progress" class="progress">0%</div>
  </div>

  <div id="status" class="status" style="display:none;">
    <div id="spinner" class="spinner"></div>
    <span id="statusText">ƒêang kh·ªüi t·∫°o...</span>
  </div>

  <div id="result"></div>
</div>

<script>
async function createBook() {
  const files = document.getElementById("images").files;
  const prompt = document.getElementById("prompt").value;
  const result = document.getElementById("result");
  const progress = document.getElementById("progress");
  const statusBox = document.getElementById("status");
  const statusText = document.getElementById("statusText");
  const spinner = document.getElementById("spinner");

  if (!files.length || !prompt.trim()) {
    alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn ·∫£nh v√† nh·∫≠p m√¥ t·∫£!");
    return;
  }

  result.innerHTML = "";
  statusBox.style.display = "flex";
  statusBox.className = "status";
  spinner.style.display = "block";
  spinner.className = "spinner";

  const formData = new FormData();
  for (let f of files) formData.append("images", f);
  formData.append("prompt", prompt);

  function setProgress(p, text) {
    progress.style.width = p + "%";
    progress.textContent = p + "%";
    statusText.textContent = text;
  }

  try {
    setProgress(10, "üîå ƒêang k·∫øt n·ªëi m√°y ch·ªß...");
    await new Promise(r => setTimeout(r, 600));

    setProgress(30, "üì° G·ª≠i y√™u c·∫ßu t·ªõi Stable Horde...");
    await new Promise(r => setTimeout(r, 600));

    setProgress(55, "‚è≥ AI ƒëang x·∫øp h√†ng x·ª≠ l√Ω (c√≥ th·ªÉ m·∫•t 1‚Äì2 ph√∫t)...");
    
    const res = await fetch("http://127.0.0.1:8000/create-book", {
      method: "POST",
      body: formData
    });

    if (!res.ok) throw new Error("SERVER_ERROR");

    setProgress(85, "üé® AI ƒëang render ·∫£nh...");
    const data = await res.json();

    setProgress(100, "‚úÖ Ho√†n t·∫•t!");
    spinner.className = "spinner stop";
    statusBox.classList.add("success");

    data.pages.forEach(p => {
      result.innerHTML += `
        <div class="page">
          <h3>üìÑ Trang ${p.page}</h3>
          <img src="${p.image_url}">
          <p>${p.caption}</p>
        </div>
      `;
    });

  } catch (e) {
    spinner.style.display = "none";
    statusBox.className = "status error";
    statusText.textContent = "‚ùå AI qu√° t·∫£i ho·∫∑c kh√¥ng ph·∫£n h·ªìi, h√£y th·ª≠ l·∫°i";
  }
}
</script>

</body>
</html>
