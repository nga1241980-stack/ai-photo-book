<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>AI Photo Book</title>

<style>
:root {
  --primary: #6366f1;
  --secondary: #22d3ee;
  --bg: radial-gradient(circle at top, #111827, #020617);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

.container {
  width: 100%;
  max-width: 820px;
  padding: 35px;
  border-radius: 18px;
  background: rgba(255,255,255,.08);
  backdrop-filter: blur(14px);
  box-shadow: 0 0 60px rgba(99,102,241,.35);
  animation: fadeUp .8s ease;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

h2 {
  text-align: center;
  font-size: 30px;
  margin-bottom: 25px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

input, textarea {
  width: 100%;
  margin-top: 14px;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 15px;
  outline: none;
  background: rgba(255,255,255,.15);
  color: white;
}

input::file-selector-button {
  background: var(--primary);
  border: none;
  color: white;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
}

textarea::placeholder { color: #c7d2fe; }

button {
  margin-top: 20px;
  width: 100%;
  padding: 16px;
  border-radius: 14px;
  border: none;
  font-size: 17px;
  font-weight: 700;
  cursor: pointer;
  color: white;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  box-shadow: 0 0 25px rgba(99,102,241,.6);
  transition: all .35s ease;
}

button:hover {
  transform: translateY(-2px) scale(1.01);
  box-shadow: 0 0 45px rgba(34,211,238,.85);
}

.progress-bar {
  margin-top: 22px;
  background: rgba(255,255,255,.15);
  border-radius: 999px;
  overflow: hidden;
}

.progress {
  height: 24px;
  width: 0%;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  text-align: center;
  font-weight: 700;
  line-height: 24px;
  transition: width .5s ease;
}

.status {
  margin-top: 18px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 600;
}

.spinner {
  width: 22px;
  height: 22px;
  border: 3px solid rgba(255,255,255,.25);
  border-top: 3px solid var(--secondary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.spinner.stop { animation: none; }

@keyframes spin { to { transform: rotate(360deg); } }

.status.error { color: #f87171; }
.status.success { color: #4ade80; }

.page {
  margin-top: 32px;
  padding: 18px;
  border-radius: 14px;
  background: rgba(255,255,255,.12);
  box-shadow: 0 0 30px rgba(0,0,0,.25);
  animation: fadeUp .6s ease;
}

.page img {
  width: 100%;
  border-radius: 12px;
  box-shadow: 0 0 25px rgba(0,0,0,.45);
}

footer {
  margin-top: 30px;
  text-align: center;
  font-size: 14px;
  opacity: .75;
}

footer span {
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 700;
}
</style>
</head>

<body>

<div class="container">
  <h2>üìò AI Photo Book</h2>

  <input type="file" id="images" multiple>
  <textarea id="prompt" placeholder="Cinematic, soft light, illustration..."></textarea>
  <button onclick="createBook()">‚ú® T·∫°o ·∫£nh AI</button>

  <div class="progress-bar">
    <div id="progress" class="progress">0%</div>
  </div>

  <div id="status" class="status" style="display:none;">
    <div id="spinner" class="spinner"></div>
    <span id="statusText"></span>
  </div>

  <div id="result"></div>

  <footer>
    Made by <span>Pkkhangzt</span> ‚ú®
  </footer>
</div>

<script>
async function createBook() {
  const files = document.getElementById("images").files;
  const prompt = document.getElementById("prompt").value;
  const result = document.getElementById("result");
  const progress = document.getElementById("progress");
  const statusBox = document.getElementById("status");
  const statusText = document.getElementById("statusText");
  const spinner = document.getElementById("spinner");

  if (!files.length || !prompt.trim()) {
    alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn ·∫£nh v√† nh·∫≠p prompt");
    return;
  }

  result.innerHTML = "";
  statusBox.style.display = "flex";
  spinner.className = "spinner";

  const formData = new FormData();
  for (let f of files) formData.append("images", f);
  formData.append("prompt", prompt);

  function setProgress(p, text) {
    progress.style.width = p + "%";
    progress.textContent = p + "%";
    statusText.textContent = text;
  }

  try {
    setProgress(20, "üîå K·∫øt n·ªëi m√°y ch·ªß...");
    await new Promise(r => setTimeout(r, 500));

    setProgress(45, "üì° G·ª≠i y√™u c·∫ßu AI...");
    await new Promise(r => setTimeout(r, 500));

    setProgress(65, "‚è≥ AI ƒëang x·ª≠ l√Ω (c√≥ th·ªÉ h∆°i l√¢u)...");
    
    /* ‚úÖ QUAN TR·ªåNG: D√ôNG RELATIVE URL */
    const res = await fetch("/create-book", {
      method: "POST",
      body: formData
    });

    if (!res.ok) throw new Error();

    setProgress(90, "üé® ƒêang render ·∫£nh...");
    const data = await res.json();

    setProgress(100, "‚úÖ Ho√†n t·∫•t!");
    spinner.className = "spinner stop";
    statusBox.classList.add("success");

    data.pages.forEach(p => {
      result.innerHTML += `
        <div class="page">
          <h3>üìÑ Trang ${p.page}</h3>
          <img src="${p.image_url}">
          <p>${p.caption}</p>
        </div>
      `;
    });

  } catch {
    spinner.style.display = "none";
    statusBox.className = "status error";
    statusText.textContent = "‚ùå AI qu√° t·∫£i ho·∫∑c l·ªói server, th·ª≠ l·∫°i sau";
  }
}
</script>

</body>
</html>
